% To Serve Man — LaTeX Preamble
% Professional cookbook typography following classic book design

\documentclass[10pt,twoside,openright]{book}

% Page geometry - classic book proportions with binding offset
\usepackage[
    letterpaper,
    inner=0.75in,
    outer=1in,
    top=0.85in,
    bottom=1.25in,
    bindingoffset=0.125in,
    headsep=0.35in,
    footskip=0.5in
]{geometry}

% Font configuration
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% Enhanced microtype for professional typography
\usepackage[
    activate={true,nocompatibility},
    final,
    tracking=true,
    kerning=true,
    spacing=true,
    factor=1100,
    stretch=10,
    shrink=10
]{microtype}

% Use EB Garamond for body text
\usepackage{ebgaramond}

% Use Helvetica for sans-serif
\usepackage{helvet}

% Professional typography settings
\frenchspacing                % single space after periods
\widowpenalty=10000           % prevent widows
\clubpenalty=10000            % prevent orphans
\brokenpenalty=10000          % discourage hyphenation across pages

% Body text leading
\linespread{1.08}

% Prevent awkward page breaks
\usepackage{needspace}

% Section formatting
\usepackage[explicit]{titlesec}

% Part formatting - dramatic, centered
\titleformat{\part}[display]
    {\centering\normalfont\scshape}
    {\Large Part \thepart}
    {1\baselineskip}
    {\huge\textls[250]{#1}}
\titlespacing*{\part}
    {0pt}
    {0.35\textheight}
    {0pt}

% Chapter formatting - small caps, centered, dropped 1/3 down page, with rules
\titleformat{\chapter}[display]
    {\normalfont\Large\scshape}
    {}
    {0pt}
    {\titlerule\addvspace{0.10\baselineskip}\centering\textls[200]{#1}}
    [\vspace{0.20\baselineskip}\titlerule]
\titlespacing*{\chapter}
    {0pt}
    {0.3\textheight}
    {3\baselineskip}

% Ensure chapters start on recto (right-hand/odd) pages
\let\originalchapter\chapter
\renewcommand{\chapter}{\cleardoublepage\originalchapter}

% Recipe title (section) - larger, refined small caps with letterspacing
\titleformat{\section}
    {\normalfont\LARGE\scshape}
    {}
    {0pt}
    {\textls[150]{#1}}
\titlespacing*{\section}
    {0pt}
    {2.5\baselineskip}
    {0.75\baselineskip}

% Subsection - "Ingredients", "Instructions" - larger small caps
\titleformat{\subsection}
    {\normalfont\large\scshape}
    {}
    {0pt}
    {\textls[100]{#1}}
\titlespacing*{\subsection}
    {0pt}
    {1.25\baselineskip}
    {0.5\baselineskip}

% Subsubsection - "Make the sauce" - italic, not bold
\titleformat{\subsubsection}
    {\normalfont\normalsize\itshape}
    {}
    {0pt}
    {#1}
\titlespacing*{\subsubsection}
    {0pt}
    {1.25\baselineskip}
    {0.5\baselineskip}

% Lists
\usepackage{enumitem}
\usepackage{xcolor}

% Define colors
\definecolor{accentcolor}{HTML}{c1121f}
\definecolor{lighttext}{HTML}{6b6560}

% Ingredient lists - en-dash bullets
\newlist{ingredients}{itemize}{1}
\setlist[ingredients]{
    label={--},
    leftmargin=1.5em,
    itemsep=0.25\baselineskip,
    parsep=0pt,
    topsep=0.5\baselineskip
}

% Instructions - refined numbered lists
\setlist[enumerate]{
    leftmargin=2em,
    itemsep=0.5\baselineskip,
    parsep=0.25\baselineskip,
    topsep=0.5\baselineskip
}

% Headers and footers - small caps, no rules
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE]{\small\scshape\MakeLowercase{\leftmark}}
\fancyhead[RO]{\small\scshape\MakeLowercase{\rightmark}}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}

% Chapter page style (no header)
\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[C]{\thepage}
    \renewcommand{\headrulewidth}{0pt}
}

% Hyperlinks (for digital PDF)
\usepackage[
    colorlinks=true,
    linkcolor=black,
    urlcolor=black,
    citecolor=black,
    bookmarks=true,
    bookmarksnumbered=false,
    pdfborder={0 0 0}
]{hyperref}

% Better tables
\usepackage{booktabs}

% Graphics
\usepackage{graphicx}

% Better quotes
\usepackage{csquotes}

% Epigraphs
\usepackage{epigraph}
\setlength{\epigraphwidth}{0.7\textwidth}
\renewcommand{\epigraphflush}{center}
\renewcommand{\sourceflush}{center}

% Table of contents - refined
\usepackage{tocloft}
\renewcommand{\cftchapfont}{\normalfont\scshape}
\renewcommand{\cftchappagefont}{\normalfont}
\renewcommand{\cftdotsep}{3}
\setlength{\cftbeforechapskip}{1.5\baselineskip}
\setlength{\cftbeforesecskip}{0.5\baselineskip}
\renewcommand{\cftpartfont}{\normalfont\large\scshape}
\setlength{\cftbeforepartskip}{2\baselineskip}
\renewcommand{\cftsecfont}{\normalfont}
\renewcommand{\cftsecpagefont}{\normalfont}

% Redefine tableofcontents to match chapter formatting
\makeatletter
\renewcommand{\tableofcontents}{%
    \cleardoublepage
    \thispagestyle{plain}
    \vspace*{0.3\textheight}
    \titlerule
    \par\addvspace{0.10\baselineskip}
    {\centering\normalfont\Large\scshape\textls[200]{contents}\par}
    \vspace{0.20\baselineskip}
    \titlerule
    \vspace{3\baselineskip}
    \@starttoc{toc}%
}
\makeatother

% Recipe metadata - small italic
\newcommand{\recipemeta}[1]{%
    \vspace{0.35\baselineskip}%
    {\small\itshape\color{lighttext}#1}%
    \par\vspace{0.5\baselineskip}%
}

% Recipe description - italic
\newcommand{\recipedescription}[1]{%
    {\itshape #1}%
    \par\vspace{1\baselineskip}%
}

% Recipe attribution - right-aligned, italic, smaller
\newcommand{\recipeattribution}[1]{%
    \vspace{1\baselineskip}%
    \begin{flushright}%
        {\small\itshape #1}%
    \end{flushright}%
}

% Cocktail metadata - glass, spirit, garnish
\newcommand{\cocktailmeta}[3]{%
    \vspace{0.5\baselineskip}%
    {\small\itshape\color{lighttext}#1%
    \ifx&#2&\else\ · #2\fi%
    \ifx&#3&\else\ · Garnish: #3\fi}%
    \par\vspace{0.75\baselineskip}%
}

% Spacing adjustments
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.5em}

% Use ragged right to avoid awkward word spacing
\raggedright

% Start of document content
\begin{document}

% Front matter
\frontmatter

% Half-title page
\begin{titlepage}
{\centering
\vspace*{0.3\textheight}
{\huge\scshape\textls[300]{{COOKBOOK_TITLE_LOWER}}}
\par}
\end{titlepage}

\cleardoublepage

% Title page
\begin{titlepage}
{\centering
\vspace*{0.3\textheight}
{\huge\scshape\textls[300]{{COOKBOOK_TITLE_LOWER}}}\\[2\baselineskip]
{\large\itshape A Personal Cookbook}
\vfill
{{COOKBOOK_AUTHOR_LINE}}
{\small Generated \today}
\vspace{0.1\textheight}
\par}
\end{titlepage}

\cleardoublepage

% Epigraph
\thispagestyle{empty}
\vspace*{0.25\textheight}
\begin{center}
{\Large\itshape``It's a cookbook!''}

\vspace{0.5\baselineskip}
\rule{0.4\textwidth}{0.4pt}
\vspace{0.5\baselineskip}

---\textsc{The Twilight Zone}, 1962
\end{center}

\cleardoublepage

% Table of contents
\tableofcontents

\cleardoublepage

% Main matter
\mainmatter

